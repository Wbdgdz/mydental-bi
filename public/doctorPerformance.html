<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Performances des MÃ©decins</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="doctor-performance.css">
    <link rel="stylesheet" href="doctor-comparison.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    
    <nav class="main-nav">
        <a href="/" class="nav-brand">
            <img src="logo3.png" alt="Logo" class="nav-logo">
            MYDental BI
        </a>
        <ul class="nav-links">
            <li><a href="/">Tableau de bord Clinique</a></li>
            <li><a href="/doctorPerformance.html" class="active">Performance MÃ©decins</a></li>
            <li><a href="/simulateur-rentabilite.html">Simulateur de RentabilitÃ©</a></li>
        </ul>
            <button id="logout-btn" class="nav-logout-btn">DÃ©connexion</button>
    </nav>

    <h1 class="page-title">Analyse des Performances des MÃ©decins</h1>

    <!-- Switch Mode Performance / Comparaison -->
    <div class="mode-switch-container">
        <button id="mode-individual" class="mode-btn active">
            <span class="mode-icon">ðŸ‘¤</span>
            Performance Individuelle
        </button>
        <button id="mode-comparison" class="mode-btn">
            <span class="mode-icon">ðŸ“Š</span>
            Comparaison
        </button>
    </div>

    <!-- Mode Performance Individuelle -->
    <div id="individual-mode" class="mode-content">
        <div class="period-selector">
            <label for="doctor-select">MÃ©decin :</label>
            <select id="doctor-select">
            </select>

            <label for="start-date">DÃ©but :</label>
            <input type="date" id="start-date" name="start-date">
            
            <label for="end-date">Fin :</label>
            <input type="date" id="end-date" name="end-date">
            
            <button id="apply-period">Appliquer</button>
        </div>
    </div>

    <!-- Mode Comparaison -->
    <div id="comparison-mode" class="mode-content" style="display: none;">
        <div class="comparison-selector">
            <div class="doctor-selectors">
                <div class="doctor-selector-group">
                    <label for="doctor-select-1">MÃ©decin 1 :</label>
                    <select id="doctor-select-1" class="doctor-compare-select">
                        <option value="">-- SÃ©lectionner --</option>
                    </select>
                </div>
                <div class="doctor-selector-group">
                    <label for="doctor-select-2">MÃ©decin 2 :</label>
                    <select id="doctor-select-2" class="doctor-compare-select">
                        <option value="">-- SÃ©lectionner --</option>
                    </select>
                </div>
                <div class="doctor-selector-group">
                    <label for="doctor-select-3">MÃ©decin 3 (optionnel) :</label>
                    <select id="doctor-select-3" class="doctor-compare-select">
                        <option value="">-- SÃ©lectionner --</option>
                    </select>
                </div>
            </div>
            
            <div class="comparison-period">
                <label for="comparison-start-date">PÃ©riode :</label>
                <input type="date" id="comparison-start-date" name="comparison-start-date">
                <span>au</span>
                <input type="date" id="comparison-end-date" name="comparison-end-date">
            </div>

            <button id="compare-btn" class="btn-compare" disabled>
                <span class="btn-icon">ðŸ“Š</span>
                Comparer
            </button>
        </div>

        <!-- Message d'instructions -->
        <div id="comparison-instruction" class="instruction-card">
            <div class="instruction-icon">ðŸ‘†</div>
            <h3>Comment utiliser la comparaison ?</h3>
            <ol>
                <li>SÃ©lectionnez au minimum 2 mÃ©decins (maximum 4)</li>
                <li>Choisissez une pÃ©riode d'analyse</li>
                <li>Cliquez sur "Comparer" pour voir les rÃ©sultats</li>
            </ol>
        </div>

        <!-- RÃ©sultats de comparaison (cachÃ©s par dÃ©faut) -->
        <div id="comparison-results" style="display: none;">
            <!-- Le contenu sera injectÃ© dynamiquement -->
        </div>
    </div>

    <div id="stats-card-container">
        <div class="stats-card">
            <div class="stats-title">Patients uniques</div>
            <div class="stats-value" id="unique-patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Visites</div>
            <div class="stats-value" id="total-visits">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Patients (sans retour)</div>
            <div class="stats-value" id="patients-premiere-visite-pas-retour">Chargement...</div>
        </div>
        
        <div class="stats-card">
            <div class="stats-title">Nouveaux patients</div>
            <div class="stats-value" id="new-patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Visites (Nouveaux patients)</div>
            <div class="stats-value" id="visits-generated-by-new-patients">Chargement...</div>
        </div>
        
        <div class="stats-card">
            <div class="stats-title">Patients (1Ã¨re visite clinique)</div>
            <div class="stats-value" id="patients-premiere-visite">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Visites (1Ã¨re visite clinique)</div>
            <div class="stats-value" id="visites-premiere-visite">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Patients fidÃ¨les</div>
            <div class="stats-value" id="loyal-patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Visites de suivi</div>
            <div class="stats-value" id="follow-up-visits">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Total des revenus</div>
            <div class="stats-value" id="total-revenue-consultations">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Heures patient</div>
            <div class="stats-value" id="total-hours-worked">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">CA par heure</div>
            <div class="stats-value" id="revenue-per-hour">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Temps Patient moyen</div>
            <div class="stats-value" id="hours-worked">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Temps d'attente moyen</div>
            <div class="stats-value" id="avg-waiting-time">Chargement...</div>
        </div>
    </div>

    <div class="charts-container">
        
        <div class="chart-container">
            <div class="chart-title">Analyse : Visites vs Revenus</div>
            <svg id="visits-revenue-chart"></svg>
        </div>

        <div class="table-container">
            <h2>DÃ©tail des Actes EffectuÃ©s</h2>
            <table id="actes-table">
                <thead>
                    <tr>
                        <th>Acte</th>
                        <th>Patients</th>
                        <th>Nombre d'actes</th>
                        <th>Revenus (DA)</th>
                        <th>Heures</th>
                        <th>CoÃ»t/Heure (DA)</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

        <div class="chart-container">
            <div class="chart-title">Analyse de la fidÃ©litÃ© des patients</div>
            <svg id="patients-chart"></svg>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">Ã‰volution du Temps</div>
            <svg id="performance-chart"></svg>
        </div>

        <div class="chart-container">
            <div class="chart-title">GÃ©nÃ©ration des rendez-vous</div>
            <svg id="appointments-chart"></svg> 
        </div>

        <div class="chart-container">
            <div class="chart-title">Temps de travail</div>
            <svg id="work-time-chart"></svg> 
        </div>

        <div class="chart-container">
            <div class="chart-title">Temps d'Attente Moyen (Heatmap)</div>
            <svg id="waiting-time-heatmap"></svg>
        </div>

    </div>

    <footer class="site-footer">
        <div class="w-full mx-auto">
            <span>Â© 2025 <a href="#">MyDental BI</a>. All Rights Reserved.</span>
        </div>
    </footer>

    <button id="back-to-top" title="Retour en haut">â†‘</button>

    <script type="module" src="./doctor/main.js"></script>
    <script type="module" src="./utilities/utils.js"></script>
    <script type="module" src="./doctor/comparisonMode.js"></script>
</body>
</html>