<!-- Index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord de la clinique</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="clinic-dashboard.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Biblioth√®ques pour l'export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <nav class="main-nav">
        <a href="/" class="nav-brand">
            <img src="logo3.png" alt="Logo" class="nav-logo"> MYDental BI
        </a>
        <ul class="nav-links">
            <li><a href="/" class="active">Tableau de bord Clinique</a></li>
            <li><a href="/doctorPerformance.html">Performance M√©decins</a></li>
            <li><a href="/simulateur-rentabilite.html">Simulateur de Rentabilit√©</a></li>
            <li><a href="/financial-analysis.html">Analyse Financi√®re</a></li>
            <li><a href="/patient-analysis.html">Analyse Patients</a></li>
        </ul>
            <button id="logout-btn" class="nav-logout-btn">D√©connexion</button>
    </nav>

    <!-- Bouton pour ouvrir/fermer le menu -->
    <div id="menu-toggle" class="menu-icon">
        &#9776;
    </div>

    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            Navigation Rapide
        </div>
        <ul>
            <li><a href="#stats-card-container">Indicateurs Cl√©s</a></li>
            <li><a href="#visits-revenue-chart">Analyse Visites & Revenus</a></li>
            <li><a href="#hourly-revenue-heatmap">Analyse Horaire</a></li>
            <li><a href="#actes-table">D√©tail des Actes</a></li>
            <li><a href="#medecins-table">Performance M√©decins</a></li>
            <li><a href="#waiting-time-monthly-chart">Temps d'Attente</a></li>
            <li><a href="#stacked-bar-chart">Analyse Rendez-vous</a></li>
            <li><a href="#rentabilite-section">Rentabilit√©</a></li>
        </ul>
    </nav>

    <!-- Contenu principal -->
    <h1 class="page-title">Tableau de bord de la clinique</h1>

    <div class="period-selector">
        <label for="start-date">D√©but :</label>
        <input type="date" id="start-date">
        <label for="end-date">Fin :</label>
        <input type="date" id="end-date">
        <button id="apply-period">Appliquer</button>
        
        <div style="margin-left: auto; display: flex; gap: 10px;">
            <button id="export-pdf-btn" class="btn-export" title="Exporter en PDF">
                üìÑ Exporter PDF
            </button>
        </div>
    </div>

    <!-- Section des indicateurs -->
    <div id="stats-card-container">
        <div class="stats-card">
            <div class="stats-title">Nombre de patients</div>
            <div class="stats-value" id="total_patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Nombre de visites</div>
            <div class="stats-value" id="total-visits">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Chiffre d'affaires</div>
            <div class="stats-value" id="CA">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">CA par Heure</div>
            <div class="stats-value" id="CA_Per_hour">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Nouveaux patients</div>
            <div class="stats-value" id="new-patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Patients fid√®les</div>
            <div class="stats-value" id="loyal-patients">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Nouveaux patients revenants</div>
            <div class="stats-value" id="new-patients-continued">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Rendez-vous planifi√©s</div>
            <div class="stats-value" id="total_rendez_vous">Chargement...</div>
        </div>

        <div class="stats-card">
            <div class="stats-title">Temps d'attente moyen</div>
            <div class="stats-value" id="avg-waiting-time">Chargement...</div>
        </div>
    </div>

    <!-- Premi√®re visualisation : Visites et revenus par mois -->
    <div class="chart-container">
        <div class="chart-title">Analyse de la relation entre le nombre de visites et les revenus par mois</div>
        <svg id="visits-revenue-chart"></svg>
    </div>

    <!-- Deuxi√®me visualisation : √âvolution des patients avec au moins deux visites -->
    <div class="chart-container">
        <div class="chart-title">√âvolution des patients avec au moins deux visites</div>
        <svg id="patient-visits-chart"></svg>
    </div>

    <!-- Visualisation: Heatmap des revenus horaires -->
    <div class="chart-container">
        <div class="chart-title">Analyse des revenus par tranche horaire et par mois</div>
        <svg id="hourly-revenue-heatmap"></svg>
    </div>

    <!-- Visualisation : Heatmap pour les patients uniques -->
    <div class="chart-container">
        <div class="chart-title">Analyse du nombre de patients uniques ayant visit√© la clinique pendant chaque cr√©neau horaire</div>
        <svg id="unique-patients-heatmap"></svg>
    </div>

    <!-- Visualisation : Heatmap des visites successives -->
    <div class="chart-container">
        <div class="chart-title">Analyse du nombre de visites suppl√©mentaires apr√®s la premi√®re visite par tranche horaire</div>
        <svg id="subsequent-visits-heatmap"></svg>
    </div>

    <!-- Tableau des Actes Dentaires -->
    <!-- <div class="chart-title">Tableau des Actes Dentaires</div> -->
    <div class="table-container">
        <h2>Analyse des Actes Dentaires</h2>
        <table id="actes-table">
            <thead>
                <tr>
                    <th>Acte</th>
                    <th>Patients Uniques</th>
                    <th>Total Visites</th>
                    <th>Chiffre d'Affaires (DA)</th>
                    <th>Total Heures</th>
                    <th>Co√ªt Moyen par Heure (DA)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les donn√©es seront inject√©es ici -->
            </tbody>
        </table>
    </div>

    <div class="table-container">
        <h2>Performance par M√©decin</h2>
        <table id="medecins-table">
            <thead>
                <tr>
                    <th>M√©decin</th>
                    <th>Consultations</th>
                     <th>Chiffre d'Affaires (DA)</th>
                    <th>Co√ªt par Consultation (DA)</th>
                    <th>Total Heures</th>
                    <th>Tarif par Heure (DA)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les donn√©es seront inject√©es ici via JS -->
            </tbody>
        </table>
    </div>

    <!-- Comparaison du tarif et du temps de travail -->
    <div class="chart-container">
        <h2>Comparaison du Tarif par Heure et du Temps Travaill√©</h2>
        <svg id="tarif-heure-chart"></svg>
    </div>

    <!-- Temps d'attente moyen par mois -->
    <div class="chart-container">
        <h2>Temps d'Attente Moyen (Clinique)</h2>
        <svg id="waiting-time-monthly-chart"></svg>
    </div>
    
    <!-- Temps d'attente moyen par m√©decin -->
    <div class="chart-container">
        <h2>Temps d'Attente Moyen par M√©decin</h2>
        <svg id="waiting-time-doctors-chart"></svg>
    </div>
    
    <!-- Temps d'attente moyen par plage horaire -->
    <div class="chart-container">
        <h2>Temps d'Attente Moyen par Plage Horaire et par Mois</h2>
        <svg id="waiting-time-heatmap"></svg>
    </div>

    <!-- Analyse des rendez-vous -->
    <div class="chart-container">
        <h2>Analyse des rendez-vous</h2>
        <svg id="stacked-bar-chart"></svg>
    </div>

    <!-- Section Rentabilit√© des Actes (bas√©e sur simulation sauvegard√©e) -->
    <div id="rentabilite-section" class="chart-container" style="display: none;">
        <h2>üìä Analyse de Rentabilit√© des Actes</h2>
        <p class="section-description">
            Donn√©es issues de la derni√®re simulation du simulateur de rentabilit√©.
            <a href="/simulateur-rentabilite.html" class="btn-simulateur" style="display: inline-block; background-color: var(--primary-color); color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; margin-left: 10px; transition: all 0.3s ease;">
                üìà Aller au simulateur
            </a>
        </p>
        
        <div id="rentabilite-info" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
            <strong>‚ÑπÔ∏è Simulation:</strong> <span id="simulation-info-text">Aucune simulation disponible</span>
        </div>

        <div id="rentabilite-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <!-- Stats seront ajout√©es dynamiquement -->
        </div>

        <!-- Graphiques g√©n√©raux -->
        <div id="rentabilite-charts-container">
            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">Top 10 Actes par Chiffre d'Affaires</h3>
                <div id="rentabilite-ca-chart" style="width: 100%; min-height: 400px;"></div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">Distribution du CA par Acte</h3>
                <div id="rentabilite-marge-chart" style="width: 100%; min-height: 400px;"></div>
            </div>
        </div>
    </div>

    <!-- Scripts pour les visualisations -->
    <script type="module"  src="./clinic/visitsRevenue.js"></script>
    <script type="module"  src="./clinic/patientVisits.js"></script>
    <script type="module"  src="./clinic/consultations.js"></script>
    <script type="module"  src="./clinic/heatmap.js"></script>
    <script type="module"  src="./clinic/hourlyRevenueHeatmap.js"></script>
    <script type="module"  src="./clinic/actesTable.js"></script>
    <script type="module"  src="./clinic/stats.js"></script>
    <script type="module"  src="./clinic/medecinsPerformance.js"></script>
    <script type="module"  src="./clinic/waitingTimes.js"></script>
    <script type="module"  src="./clinic/heatmap-waiting-time.js"></script>
    <script type="module"  src="./clinic/rendezvous.js"></script>
    <script type="module"  src="./clinic/main.js"></script><!-- New JS file for doctor performance -->
    <script type="module"  src="./utilities/utils.js"></script>



    

    <footer class="site-footer">
        <div class="w-full mx-auto max-w-screen-xl p-4">
            <span>¬© 2025 <a href="#">MyDental BI</a>. All Rights Reserved.</span>
        </div>
    </footer>

    <button id="back-to-top" title="Retour en haut">‚Üë</button>

    <script type="module" src="./clinic/visitsRevenue.js"></script>
    <script type="module" src="./utilities/utils.js"></script>

</body>
</html>
